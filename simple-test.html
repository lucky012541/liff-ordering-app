<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Test Runner</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .btn:hover {
            background: #2980b9;
        }
        .btn.success {
            background: #27ae60;
        }
        .btn.warning {
            background: #f39c12;
        }
        .btn.danger {
            background: #e74c3c;
        }
        .log {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: monospace;
            height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 5px;
        }
        .log-success {
            color: #2ecc71;
        }
        .log-error {
            color: #e74c3c;
        }
        .log-warning {
            color: #f39c12;
        }
        .status {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .status-item {
            text-align: center;
            padding: 10px;
            border-radius: 4px;
        }
        .status-success {
            background: #d5f4e6;
            color: #27ae60;
        }
        .status-error {
            background: #fadbd8;
            color: #e74c3c;
        }
        .status-info {
            background: #d6eaf8;
            color: #3498db;
        }
        .iframe-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .iframe-header {
            background: #34495e;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Simple Test Runner</h1>
            <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢</p>
        </div>

        <div class="controls">
            <button class="btn" onclick="startTest()">‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
            <button class="btn success" onclick="testProducts()">üõçÔ∏è ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
            <button class="btn warning" onclick="testCheckout()">üí≥ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button>
            <button class="btn danger" onclick="clearLog()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</button>
        </div>

        <div class="status">
            <div class="status-item status-info">
                <h3 id="totalTests">0</h3>
                <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
            </div>
            <div class="status-item status-success">
                <h3 id="passedTests">0</h3>
                <p>‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö</p>
            </div>
            <div class="status-item status-error">
                <h3 id="failedTests">0</h3>
                <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</p>
            </div>
        </div>

        <div class="log" id="testLog">
            <div class="log-entry">ü§ñ Test Runner ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô...</div>
        </div>

        <div class="iframe-container">
            <div class="iframe-header">
                <span>üì± ‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏î‡∏™‡∏≠‡∏ö</span>
                <button class="btn" onclick="reloadApp()">üîÑ ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î</button>
            </div>
            <iframe id="testFrame" src="index.html"></iframe>
        </div>
    </div>

    <script>
        let testStats = { total: 0, passed: 0, failed: 0 };
        let isTestRunning = false;

        // Log message to console
        function log(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        // Update statistics
        function updateStats() {
            document.getElementById('totalTests').textContent = testStats.total;
            document.getElementById('passedTests').textContent = testStats.passed;
            document.getElementById('failedTests').textContent = testStats.failed;
        }

        // Test helper function
        function testStep(description, testFunction) {
            return new Promise((resolve) => {
                testStats.total++;
                log(`üîç ${description}`, 'info');
                
                try {
                    const result = testFunction();
                    if (result !== false) {
                        testStats.passed++;
                        log(`‚úÖ ${description} - ‡∏ú‡πà‡∏≤‡∏ô`, 'success');
                        resolve(true);
                    } else {
                        testStats.failed++;
                        log(`‚ùå ${description} - ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß`, 'error');
                        resolve(false);
                    }
                } catch (error) {
                    testStats.failed++;
                    log(`‚ùå ${description} - ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}`, 'error');
                    resolve(false);
                }
                
                updateStats();
            });
        }

        // Delay function
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Get iframe document
        function getIframeDoc() {
            const iframe = document.getElementById('testFrame');
            return iframe.contentDocument || iframe.contentWindow.document;
        }

        // Check if app is ready
        function isAppReady() {
            try {
                const doc = getIframeDoc();
                const app = doc.querySelector('#productsGrid') || doc.querySelector('.nav-tab');
                return app !== null;
            } catch (error) {
                return false;
            }
        }

        // Wait for app to be ready
        function waitForApp() {
            return new Promise((resolve) => {
                const checkReady = () => {
                    if (isAppReady()) {
                        log('‚úÖ ‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô', 'success');
                        resolve(true);
                    } else {
                        log('‚è≥ ‡∏£‡∏≠‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î...', 'warning');
                        setTimeout(checkReady, 1000);
                    }
                };
                checkReady();
            });
        }

        // Test products functionality
        async function testProducts() {
            if (isTestRunning) return;
            isTestRunning = true;
            
            log('üõçÔ∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...', 'info');
            
            // Wait for app to be ready
            await waitForApp();
            
            const doc = getIframeDoc();
            
            // Test search functionality
            await testStep('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', () => {
                const searchInput = doc.getElementById('searchInput');
                if (!searchInput) return false;
                
                searchInput.value = '‡∏ô‡πâ‡∏≥';
                searchInput.dispatchEvent(new Event('input', { bubbles: true }));
                return true;
            });
            
            await delay(1000);
            
            // Test category buttons
            await testStep('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà', () => {
                const categoryBtns = doc.querySelectorAll('.category-btn');
                if (categoryBtns.length === 0) return false;
                
                categoryBtns[1]?.click(); // Click second category
                return true;
            });
            
            await delay(1000);
            
            // Test product cards
            await testStep('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', () => {
                const productCards = doc.querySelectorAll('.product-card');
                if (productCards.length === 0) return false;
                
                productCards[0]?.click(); // Click first product
                return true;
            });
            
            await delay(1500);
            
            // Test modal
            await testStep('‡∏ó‡∏î‡∏™‡∏≠‡∏ö Modal ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', () => {
                const modal = doc.getElementById('productModal');
                const addBtn = doc.getElementById('addToCartBtn');
                
                if (!modal || !addBtn) return false;
                
                addBtn.click();
                return true;
            });
            
            log('‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô', 'success');
            isTestRunning = false;
        }

        // Test checkout functionality
        async function testCheckout() {
            if (isTestRunning) return;
            isTestRunning = true;
            
            log('üí≥ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠...', 'info');
            
            // Wait for app to be ready
            await waitForApp();
            
            const doc = getIframeDoc();
            
            // First add some products to cart
            await testStep('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤', () => {
                // Try to find and click a product first
                const productCards = doc.querySelectorAll('.product-card');
                if (productCards.length > 0) {
                    productCards[0].click();
                    
                    // Wait a bit then add to cart
                    setTimeout(() => {
                        const addBtn = doc.getElementById('addToCartBtn');
                        if (addBtn) {
                            addBtn.click();
                            // Close modal
                            const closeBtn = doc.getElementById('closeModal');
                            if (closeBtn) closeBtn.click();
                        }
                    }, 500);
                    
                    return true;
                }
                return false;
            });
            
            await delay(2000);

            // Test checkout button
            await testStep('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠', () => {
                const checkoutBtn = doc.getElementById('checkoutBtnMini') || doc.getElementById('checkoutBtn');
                if (!checkoutBtn) return false;
                
                checkoutBtn.click();
                return true;
            });
            
            await delay(2000);
            
            // Test customer form
            await testStep('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', () => {
                const nameInput = doc.getElementById('customerName');
                const phoneInput = doc.getElementById('customerPhone');
                const addressInput = doc.getElementById('deliveryAddress');
                
                if (!nameInput || !phoneInput || !addressInput) return false;
                
                nameInput.value = '‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡∏ö‡∏≠‡∏ó';
                phoneInput.value = '0812345678';
                addressInput.value = '123 ‡∏ñ‡∏ô‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö';
                
                nameInput.dispatchEvent(new Event('input', { bubbles: true }));
                phoneInput.dispatchEvent(new Event('input', { bubbles: true }));
                addressInput.dispatchEvent(new Event('input', { bubbles: true }));
                
                return true;
            });
            
            await delay(1000);
            
            // Test next button
            await testStep('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ', () => {
                const nextBtns = doc.querySelectorAll('.checkout-btn');
                const nextBtn = Array.from(nextBtns).find(btn => btn.textContent.includes('‡∏ñ‡∏±‡∏î‡πÑ‡∏õ'));
                
                if (!nextBtn) return false;
                
                nextBtn.click();
                return true;
            });
            
            await delay(1500);
            
            // Test payment method
            await testStep('‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô', () => {
                const cashRadio = doc.querySelector('input[name="paymentMethod"][value="cash"]');
                if (!cashRadio) return false;
                
                cashRadio.click();
                return true;
            });
            
            log('‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô', 'success');
            isTestRunning = false;
        }

        // Start full test
        async function startTest() {
            if (isTestRunning) return;
            
            log('üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î...', 'info');
            
            // Wait for app to be ready first
            await waitForApp();
            
            await testProducts();
            await delay(2000);
            await testCheckout();
            
            log('üéâ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!', 'success');
            log(`üìä ‡∏™‡∏£‡∏∏‡∏õ: ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${testStats.total} ‡∏ú‡πà‡∏≤‡∏ô ${testStats.passed} ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ${testStats.failed}`, 'info');
        }

        // Clear log
        function clearLog() {
            document.getElementById('testLog').innerHTML = '<div class="log-entry">ü§ñ Test Runner ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô...</div>';
            testStats = { total: 0, passed: 0, failed: 0 };
            updateStats();
        }

        // Reload app
        function reloadApp() {
            document.getElementById('testFrame').src = 'index.html';
            log('üîÑ ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô', 'info');
        }

        // Initialize
        window.onload = function() {
            log('‚úÖ Test Runner ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô', 'success');
            updateStats();
            
            // Auto start test after 3 seconds
            setTimeout(() => {
                log('ü§ñ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥...', 'info');
                startTest();
            }, 3000);
        };
    </script>
</body>
</html>
